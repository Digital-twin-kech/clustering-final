{
  "deployment_info": {
    "stage": "Stage 4 - PostGIS Migration",
    "coordinate_system": "UTM Zone 29N (EPSG:29180) -> WGS84 (EPSG:4326)",
    "database": "PostgreSQL 15 with PostGIS 3.3",
    "api_framework": "FastAPI with Leaflet.js visualization",
    "deployment_date": "2025-09-25",
    "target_region": "Western Morocco"
  },

  "sample_data_structure": {
    "masts": [
      {
        "mast_id": 1,
        "chunk": "chunk_1",
        "utm_coordinates": [1109256.83, 3884980.75],
        "wgs84_coordinates": [34.020912, -6.841603],
        "height_m": 12.5,
        "point_count": 2578,
        "quality_score": 0.89,
        "extraction_method": "python_mast_enhanced"
      },
      {
        "mast_id": 2,
        "chunk": "chunk_2",
        "utm_coordinates": [1109500.12, 3885100.33],
        "wgs84_coordinates": [34.021985, -6.839102],
        "height_m": 15.2,
        "point_count": 3245,
        "quality_score": 0.92,
        "extraction_method": "python_mast_enhanced"
      }
    ],

    "trees": [
      {
        "tree_id": 1,
        "chunk": "chunk_1",
        "polygon_coordinates_wgs84": [
          [[34.020900, -6.841500], [34.020910, -6.841510], [34.020905, -6.841520], [34.020900, -6.841500]]
        ],
        "area_m2": 45.7,
        "perimeter_m": 28.3,
        "point_count": 1356,
        "aspect_ratio": 1.31,
        "extraction_method": "python_instance_enhanced"
      }
    ],

    "buildings": [
      {
        "building_id": 1,
        "chunk": "chunk_2",
        "polygon_coordinates_wgs84": [
          [[34.021000, -6.840000], [34.021100, -6.840000], [34.021100, -6.840100], [34.021000, -6.840100], [34.021000, -6.840000]]
        ],
        "area_m2": 156.8,
        "perimeter_m": 52.4,
        "point_count": 2890,
        "aspect_ratio": 1.2,
        "extraction_method": "python_instance_enhanced"
      }
    ],

    "other_vegetation": [
      {
        "polygon_id": 1,
        "chunk": "chunk_1",
        "polygon_coordinates_wgs84": [
          [[34.020800, -6.841800], [34.020850, -6.841750], [34.020820, -6.841900], [34.020800, -6.841800]]
        ],
        "area_m2": 13.09,
        "perimeter_m": 17.0,
        "point_count": 155,
        "aspect_ratio": 2.48,
        "extraction_method": "python_vegetation_enhanced"
      }
    ],

    "wires": [
      {
        "line_id": 1,
        "chunk": "chunk_3",
        "line_coordinates_wgs84": [
          [34.022000, -6.838000], [34.022100, -6.838100], [34.022200, -6.838200]
        ],
        "length_m": 87.5,
        "point_count": 445,
        "extraction_method": "python_wire_enhanced"
      }
    ]
  },

  "database_statistics": {
    "expected_counts": {
      "total_masts": "~500",
      "total_trees": "~15000",
      "total_buildings": "~8000",
      "total_vegetation": "~12000",
      "total_wires": "~200",
      "total_features": "~35700"
    },

    "performance_metrics": {
      "data_migration_time": "~2-5 minutes",
      "initial_map_load": "<5 seconds",
      "api_response_time": "<2 seconds",
      "database_size": "~50-100 MB"
    }
  },

  "api_endpoints_test": {
    "health_check": {
      "url": "http://localhost:8002/api/health",
      "expected_response": {
        "status": "healthy",
        "database": "connected"
      }
    },

    "statistics": {
      "url": "http://localhost:8002/api/stats",
      "expected_fields": [
        "mast_count", "tree_count", "building_count",
        "vegetation_count", "wire_count",
        "trees_area", "buildings_area", "vegetation_area", "wires_length"
      ]
    },

    "main_data": {
      "url": "http://localhost:8002/api/data",
      "expected_structure": {
        "data": {
          "masts": ["array of mast objects with lat/lon"],
          "trees": ["array of tree polygons with coordinates"],
          "buildings": ["array of building polygons"],
          "vegetation": ["array of vegetation polygons"],
          "wires": ["array of wire lines"]
        },
        "filters": {
          "chunks": ["chunk_1", "chunk_2", "chunk_3", "etc"],
          "classes": ["masts", "trees", "buildings", "other_vegetation", "wires"]
        }
      }
    }
  },

  "docker_commands_summary": {
    "1_start_database": "docker-compose up -d postgis",
    "2_create_schema": "python3 create_schema.py",
    "3_migrate_data": "python3 migrate_data.py",
    "4_start_full_system": "docker-compose up -d",
    "5_check_status": "docker-compose ps",
    "6_view_logs": "docker-compose logs",
    "7_access_visualization": "open http://localhost:8002"
  },

  "file_structure_verification": {
    "required_files": [
      "docker-compose.yml - Container orchestration",
      "Dockerfile - API service container definition",
      "requirements.txt - Python dependencies",
      "lidar_postgis_server.py - FastAPI server with PostGIS integration",
      "create_schema.py - Database schema creation",
      "migrate_data.py - Data migration from files to PostGIS",
      "init/01_create_extensions.sql - PostGIS extension setup"
    ],

    "source_data_locations": [
      "/outlast/chunks/*/compressed/filtred_by_classes/*/centroids/*_centroids_clean.json",
      "/outlast/chunks/*/compressed/filtred_by_classes/7_Trees/polygons/*_polygons.geojson",
      "/outlast/chunks/*/compressed/filtred_by_classes/6_Buildings/polygons/*_polygons.geojson",
      "/outlast/chunks/*/compressed/filtred_by_classes/8_OtherVegetation/polygons/*_polygons.geojson",
      "/outlast/chunks/*/compressed/filtred_by_classes/11_Wires/lines/*_lines.geojson"
    ]
  },

  "success_indicators": {
    "container_health": "Both 'lidar_postgis' and 'lidar_api' show 'healthy' status",
    "database_connection": "Health endpoint returns status: healthy",
    "data_migration": "Migration script reports successful insertion counts for all classes",
    "web_interface": "Map loads at http://localhost:8002 and displays data points/polygons/lines",
    "api_functionality": "All endpoints (/api/data, /api/stats, /api/health) return valid JSON responses"
  }
}